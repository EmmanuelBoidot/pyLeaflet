<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Pyleaflet by EmmanuelBoidot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Pyleaflet</h1>
      <h2 class="project-tagline">mpld3 extension for plotting data on a Leaflet map</h2>
      <a href="https://github.com/EmmanuelBoidot/pyLeaflet" class="btn">View on GitHub</a>
      <a href="https://github.com/EmmanuelBoidot/pyLeaflet/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/EmmanuelBoidot/pyLeaflet/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="pyleaflet" class="anchor" href="#pyleaflet" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>pyLeaflet</h1>

<p>mpld3 extension for plotting data on a Leaflet map</p>

<h2>
<a id="about" class="anchor" href="#about" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>About</h2>

<p>pyLeaflet it an extension of mpld3 that provides geolocalized data visualization on a Leaflet layer as an overlay pane.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p>pyLeaflet is compatible with python 2.6-2.7 (python 3 not tested). It requires
<a href="http://mpld3.github.io">mpld3</a>,
<a href="http://matplotlib.org">matplotlib</a> version 1.3 and
<a href="http://jinja.pocoo.org/">jinja2</a> version 2.7+.</p>

<p>To install:</p>

<ul>
<li>clone project</li>
<li>
<p>within the git source directory, run</p>

<p>[~]$ python setup.py install</p>
</li>
</ul>

<h2>
<a id="description" class="anchor" href="#description" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Description</h2>

<p>The idea behind this module is to allow you to plot the same figures you would plot using mpld3. The first subplot of the figure should only contain (lon,lat) coordinates. It will be displayed on a Leaflet map. The other axes will be rendered by mpld3 as they would have been if you were using mpld3 alone.</p>

<h2>
<a id="example-plot" class="anchor" href="#example-plot" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example Plot</h2>

<p>An example script is provided in this project: see ``example.py''. In order to plot geodata using pyLeaflet, proceed as for MatPlotLib, using the longitude as the first coordinate and the latitude as the second coordinate. The code is displayed below.</p>

<div class="highlight highlight-source-python"><pre><span class="pl-c">#!/usr/bin/python</span>
<span class="pl-k">import</span> matplotlib.pyplot <span class="pl-k">as</span> plt
<span class="pl-k">import</span> matplotlib.path <span class="pl-k">as</span> mpath
<span class="pl-k">import</span> matplotlib.patches <span class="pl-k">as</span> mpatches
<span class="pl-k">import</span> numpy <span class="pl-k">as</span> np

<span class="pl-k">import</span> pyLeaflet


<span class="pl-k">def</span> <span class="pl-en">example1</span>(<span class="pl-smi">saveAs</span><span class="pl-k">=</span><span class="pl-c1">None</span>):
    <span class="pl-c1">N</span><span class="pl-k">=</span><span class="pl-c1">1000</span>

    Path <span class="pl-k">=</span> mpath.Path
    path_data <span class="pl-k">=</span> [
        (Path.<span class="pl-c1">MOVETO</span>, (<span class="pl-c1">1.58</span><span class="pl-k">-</span><span class="pl-c1">85</span>, <span class="pl-c1">35</span><span class="pl-k">-</span><span class="pl-c1">2.57</span>)),
        (Path.<span class="pl-c1">CURVE4</span>, (<span class="pl-c1">0.35</span><span class="pl-k">-</span><span class="pl-c1">85</span>, <span class="pl-c1">35</span><span class="pl-k">-</span><span class="pl-c1">1.1</span>)),
        (Path.<span class="pl-c1">CURVE4</span>, (<span class="pl-k">-</span><span class="pl-c1">1.85</span><span class="pl-k">-</span><span class="pl-c1">85</span>, <span class="pl-c1">35</span><span class="pl-k">+</span><span class="pl-c1">2.0</span>)),
        (Path.<span class="pl-c1">CURVE4</span>, (<span class="pl-c1">0.385</span><span class="pl-k">-</span><span class="pl-c1">85</span>, <span class="pl-c1">35</span><span class="pl-k">+</span><span class="pl-c1">2.0</span>)),
        (Path.<span class="pl-c1">LINETO</span>, (<span class="pl-c1">0.85</span><span class="pl-k">-</span><span class="pl-c1">85</span>, <span class="pl-c1">35</span><span class="pl-k">+</span><span class="pl-c1">1.15</span>)),
        (Path.<span class="pl-c1">CURVE4</span>, (<span class="pl-c1">2.2</span><span class="pl-k">-</span><span class="pl-c1">85</span>, <span class="pl-c1">35</span><span class="pl-k">+</span><span class="pl-c1">3.2</span>)),
        (Path.<span class="pl-c1">CURVE4</span>, (<span class="pl-c1">3</span><span class="pl-k">-</span><span class="pl-c1">85</span>, <span class="pl-c1">35</span><span class="pl-k">+</span><span class="pl-c1">0.05</span>)),
        (Path.<span class="pl-c1">CURVE4</span>, (<span class="pl-c1">2.0</span><span class="pl-k">-</span><span class="pl-c1">85</span>, <span class="pl-c1">35</span><span class="pl-k">-</span><span class="pl-c1">0.5</span>)),
        (Path.<span class="pl-c1">CLOSEPOLY</span>, (<span class="pl-c1">1.58</span><span class="pl-k">-</span><span class="pl-c1">85</span>, <span class="pl-c1">35</span><span class="pl-k">-</span><span class="pl-c1">2.57</span>)),
        ]
    codes, verts <span class="pl-k">=</span> <span class="pl-c1">zip</span>(<span class="pl-k">*</span>path_data)
    path <span class="pl-k">=</span> mpath.Path(verts, codes)
    patch <span class="pl-k">=</span> mpatches.PathPatch(path, <span class="pl-v">facecolor</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>r<span class="pl-pds">'</span></span>, <span class="pl-v">alpha</span><span class="pl-k">=</span><span class="pl-c1">0.5</span>)

    <span class="pl-c"># plot control points and connecting lines</span>
    x, y <span class="pl-k">=</span> <span class="pl-c1">zip</span>(<span class="pl-k">*</span>path.vertices[:<span class="pl-k">-</span><span class="pl-c1">1</span>])
    x2 <span class="pl-k">=</span> <span class="pl-c1">5.0</span> <span class="pl-k">*</span> np.random.randn(<span class="pl-c1">N</span>) <span class="pl-k">-</span><span class="pl-c1">84</span>
    y2 <span class="pl-k">=</span> <span class="pl-c1">2.0</span> <span class="pl-k">*</span> np.random.randn(<span class="pl-c1">N</span>) <span class="pl-k">+</span><span class="pl-c1">32</span>
    colors <span class="pl-k">=</span> np.random.rand(<span class="pl-c1">N</span>)
    size <span class="pl-k">=</span> np.pi <span class="pl-k">*</span> (<span class="pl-c1">15</span> <span class="pl-k">*</span> np.random.rand(<span class="pl-c1">N</span>))<span class="pl-k">**</span><span class="pl-c1">2</span>

    t <span class="pl-k">=</span> np.linspace(<span class="pl-c1">1</span>,<span class="pl-c1">100</span>,<span class="pl-c1">len</span>(x))
    t2 <span class="pl-k">=</span> np.linspace(<span class="pl-c1">1</span>,<span class="pl-c1">100</span>,<span class="pl-c1">len</span>(x2))

    fig, (ax1,ax2,ax3) <span class="pl-k">=</span> plt.subplots(<span class="pl-v">figsize</span><span class="pl-k">=</span>(<span class="pl-c1">18</span>, <span class="pl-c1">18</span>),<span class="pl-v">nrows</span><span class="pl-k">=</span><span class="pl-c1">3</span>,<span class="pl-v">ncols</span><span class="pl-k">=</span><span class="pl-c1">1</span>)

    ax1.add_patch(patch)
    points <span class="pl-k">=</span> ax1.plot(x, y, <span class="pl-s"><span class="pl-pds">'</span>b^<span class="pl-pds">'</span></span>, <span class="pl-v">ms</span><span class="pl-k">=</span><span class="pl-c1">10</span>)
    line <span class="pl-k">=</span> ax1.plot(x, y, <span class="pl-s"><span class="pl-pds">'</span>-k<span class="pl-pds">'</span></span>)
    scatter <span class="pl-k">=</span> ax1.scatter(x2, y2, <span class="pl-v">s</span><span class="pl-k">=</span>size, <span class="pl-v">c</span><span class="pl-k">=</span>colors, <span class="pl-v">alpha</span><span class="pl-k">=</span><span class="pl-c1">0.5</span>)
    <span class="pl-c"># this should draw a black dot on top of the empire state building</span>
    ax1.plot([<span class="pl-k">-</span><span class="pl-c1">73.9857</span>],[<span class="pl-c1">40.7484</span>],<span class="pl-s"><span class="pl-pds">'</span>ro<span class="pl-pds">'</span></span>,<span class="pl-v">ms</span><span class="pl-k">=</span><span class="pl-c1">10</span>)
    ax1.axis(<span class="pl-s"><span class="pl-pds">'</span>equal<span class="pl-pds">'</span></span>)
    ax1.set_xlabel(<span class="pl-s"><span class="pl-pds">'</span>longitude<span class="pl-pds">'</span></span>)
    ax1.set_ylabel(<span class="pl-s"><span class="pl-pds">'</span>latitude<span class="pl-pds">'</span></span>)

    ax2.plot(t,x,<span class="pl-s"><span class="pl-pds">'</span>-k<span class="pl-pds">'</span></span>)
    ax2.plot(t2,x2,<span class="pl-s"><span class="pl-pds">'</span>--g<span class="pl-pds">'</span></span>)
    ax2.set_xlabel(<span class="pl-s"><span class="pl-pds">'</span>t<span class="pl-pds">'</span></span>)
    ax2.set_ylabel(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>)
    ax2.legend([<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>x2<span class="pl-pds">'</span></span>])

    ax3.plot(t,y,<span class="pl-s"><span class="pl-pds">'</span>-k<span class="pl-pds">'</span></span>)
    ax3.plot(t2,y2,<span class="pl-s"><span class="pl-pds">'</span>--g<span class="pl-pds">'</span></span>)
    ax3.set_xlabel(<span class="pl-s"><span class="pl-pds">'</span>t<span class="pl-pds">'</span></span>)
    ax3.set_ylabel(<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>)
    ax3.legend([<span class="pl-s"><span class="pl-pds">'</span>y<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>y2<span class="pl-pds">'</span></span>])


    <span class="pl-c">###############</span>
    <span class="pl-c">###############</span>
    <span class="pl-c"># tile_layer = "http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.jpg"</span>
    tile_layer <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>http://<span class="pl-c1">{s}</span>.tile.stamen.com/terrain/<span class="pl-c1">{z}</span>/<span class="pl-c1">{x}</span>/<span class="pl-c1">{y}</span>.jpg<span class="pl-pds">"</span></span>
    html <span class="pl-k">=</span> pyLeaflet.plotWithMap(fig,<span class="pl-v">tile_layer</span> <span class="pl-k">=</span> tile_layer,<span class="pl-v">saveAs</span><span class="pl-k">=</span>saveAs)

    <span class="pl-k">return</span> html

<span class="pl-k">def</span> <span class="pl-en">render_csv_file</span>(<span class="pl-smi">fname</span>,<span class="pl-smi">delimiter</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>,<span class="pl-smi">saveAs</span><span class="pl-k">=</span><span class="pl-c1">None</span>, <span class="pl-k">**</span><span class="pl-smi">kwargs</span>):
    data <span class="pl-k">=</span> np.genfromtxt(fname,<span class="pl-v">names</span><span class="pl-k">=</span><span class="pl-c1">True</span>,<span class="pl-v">skip_header</span><span class="pl-k">=</span><span class="pl-c1">0</span>,<span class="pl-v">delimiter</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>)
    x, y <span class="pl-k">=</span>  data[<span class="pl-s"><span class="pl-pds">'</span>lon<span class="pl-pds">'</span></span>],data[<span class="pl-s"><span class="pl-pds">'</span>lat<span class="pl-pds">'</span></span>]

    fig, ax1 <span class="pl-k">=</span> plt.subplots(<span class="pl-v">figsize</span><span class="pl-k">=</span>(<span class="pl-c1">15</span>, <span class="pl-c1">18</span>),<span class="pl-v">nrows</span><span class="pl-k">=</span><span class="pl-c1">1</span>,<span class="pl-v">ncols</span><span class="pl-k">=</span><span class="pl-c1">1</span>)

    <span class="pl-c"># this plots the lines of the csv as markers, colored as a function</span>
    <span class="pl-c"># of the column `info1`, with a linear colormap blue-&gt;green</span>

    kwargs[<span class="pl-s"><span class="pl-pds">'</span>marker<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>o<span class="pl-pds">'</span></span> <span class="pl-k">if</span> <span class="pl-k">not</span> kwargs.has_key(<span class="pl-s"><span class="pl-pds">'</span>marker<span class="pl-pds">'</span></span>) <span class="pl-k">else</span> kwargs[<span class="pl-s"><span class="pl-pds">'</span>marker<span class="pl-pds">'</span></span>]
    kwargs[<span class="pl-s"><span class="pl-pds">'</span>s<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> [<span class="pl-c1">50</span>]<span class="pl-k">*</span><span class="pl-c1">len</span>(x) <span class="pl-k">if</span> <span class="pl-k">not</span> kwargs.has_key(<span class="pl-s"><span class="pl-pds">'</span>s<span class="pl-pds">'</span></span>) <span class="pl-k">else</span> kwargs[<span class="pl-s"><span class="pl-pds">'</span>s<span class="pl-pds">'</span></span>]
    kwargs[<span class="pl-s"><span class="pl-pds">'</span>cmap<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> \
        plt.get_cmap(<span class="pl-s"><span class="pl-pds">'</span>winter<span class="pl-pds">'</span></span>) <span class="pl-k">if</span> <span class="pl-k">not</span> kwargs.has_key(<span class="pl-s"><span class="pl-pds">'</span>cmap<span class="pl-pds">'</span></span>) <span class="pl-k">else</span> kwargs[<span class="pl-s"><span class="pl-pds">'</span>cmap<span class="pl-pds">'</span></span>]
    kwargs[<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> data[<span class="pl-s"><span class="pl-pds">'</span>info1<span class="pl-pds">'</span></span>] <span class="pl-k">if</span> <span class="pl-k">not</span> kwargs.has_key(<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>) <span class="pl-k">else</span> kwargs[<span class="pl-s"><span class="pl-pds">'</span>c<span class="pl-pds">'</span></span>]
    kwargs[<span class="pl-s"><span class="pl-pds">'</span>linewidths<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> \
        <span class="pl-c1">0</span> <span class="pl-k">if</span> <span class="pl-k">not</span> kwargs.has_key(<span class="pl-s"><span class="pl-pds">'</span>linewidths<span class="pl-pds">'</span></span>) <span class="pl-k">else</span> kwargs[<span class="pl-s"><span class="pl-pds">'</span>linewidths<span class="pl-pds">'</span></span>]

    <span class="pl-c1">print</span> kwargs

    ax1.scatter(x, y, <span class="pl-k">**</span>kwargs)

    ax1.axis(<span class="pl-s"><span class="pl-pds">'</span>equal<span class="pl-pds">'</span></span>)
    ax1.set_xlabel(<span class="pl-s"><span class="pl-pds">'</span>longitude<span class="pl-pds">'</span></span>)
    ax1.set_ylabel(<span class="pl-s"><span class="pl-pds">'</span>latitude<span class="pl-pds">'</span></span>)

    <span class="pl-c">###############</span>
    <span class="pl-c">###############</span>
    <span class="pl-c"># tile_layer = "http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.jpg"</span>
    tile_layer <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>http://<span class="pl-c1">{s}</span>.tile.stamen.com/terrain/<span class="pl-c1">{z}</span>/<span class="pl-c1">{x}</span>/<span class="pl-c1">{y}</span>.jpg<span class="pl-pds">"</span></span>
    html <span class="pl-k">=</span> pyLeaflet.plotWithMap(fig,<span class="pl-v">tile_layer</span> <span class="pl-k">=</span> tile_layer,<span class="pl-v">saveAs</span><span class="pl-k">=</span>saveAs)

    <span class="pl-k">return</span> html


example1(<span class="pl-v">saveAs</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>pyLeaflet_example.html<span class="pl-pds">"</span></span>)
<span class="pl-c"># render_csv_file('example.csv',linewidths=0,marker='v')</span></pre></div>

<p>The output of the script above can be found <a href="http://emmanuelboidot.github.io/pyLeaflet/example.html">here</a></p>

<p>{% include example.html %}</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/EmmanuelBoidot/pyLeaflet">Pyleaflet</a> is maintained by <a href="https://github.com/EmmanuelBoidot">EmmanuelBoidot</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-53841221-4");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
